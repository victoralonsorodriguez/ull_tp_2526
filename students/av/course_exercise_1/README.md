# N-Body Simulation - Course Exercise 1

## Description

This project implements a simple N-body gravitational simulation in Fortran. It reads the initial conditions (mass, position, velocity) for a set of particles from an input file, simulates their movement under mutual gravitational attraction using the Leapfrog integration algorithm, and writes the time evolution of their positions to an output file.

The simulation uses custom Fortran modules for handling 3D geometry (`geometry.f90`) and particle data structures (`particle.f90`). The main program (`ex1.f90`) orchestrates the simulation steps, including file input/output and the integration loop.

A Python script (`ex1_animation.py`) is provided to visualize the simulation results stored in the output file as a 3D animation.

---

## Files

* **`ex1.f90`**: The main Fortran program containing the simulation logic, Leapfrog integrator, command-line argument parsing, and file I/O operations.
* **`geometry.f90`**: A Fortran module defining `vector3d` and `point3d` types, custom operators for vector/point arithmetic (`+`, `-`, `*`, `/`), and geometric functions like `distance`, `normalize`, `angle`, `cross_product`. Precision `dp` is defined here. Types and essential operators/functions are public, while internal procedures are private.
* **`particle.f90`**: A Fortran module defining the `particle3d` data type, which holds a particle's mass (`m`), position (`p` of type `point3d`), and velocity (`v` of type `vector3d`). It uses the `geometry` module. Only the `particle3d` type is public.
* **`Makefile`**: Used to compile the Fortran source code (`geometry.f90`, `particle.f90`, `ex1.f90`) into the final executable (`ex1`). It handles module dependencies correctly.
* **`ex1_animation.py`**: A Python script to read the simulation output data file and generate a 3D animation saved as an MP4 video. It uses `numpy` for data handling and `matplotlib` for plotting/animation. It accepts command-line arguments for input and output filenames.
* **`input.dat`**: An example input file defining the simulation parameters and initial particle states.
* **`output.dat`**: An example output file generated by running the simulation with `input.dat`. Contains the time evolution of particle positions.
* **`README.md`**: This file.

---

## Prerequisites

To compile and run the entire project (simulation + visualization), you need:

1.  **Fortran Compiler**: `gfortran` is recommended and used in the `Makefile`.
2.  **Make**: The build automation tool used by the `Makefile`. Usually pre-installed on Linux/macOS.
3.  **Python**: Version 3.x.
4.  **Python Libraries**: `numpy` and `matplotlib`. Install them using pip:
    ```bash
    pip install numpy matplotlib
    ```
5.  **FFmpeg**: Required by `matplotlib` to save animations as MP4 files. Ensure it's installed and accessible in your system's PATH.

---

## Compilation

Navigate to the project directory in your terminal and use the `Makefile` to compile the Fortran code:

* To compile the executable (`ex1`):
    ```bash
    make
    ```
* To remove the executable (`ex1`), object files (`.o`), and module files (`.mod`):
    ```bash
    make clean
    ```

---

## Running the Simulation

Execute the compiled Fortran program from the terminal. You **must** provide the input file using the `-i` flag. You can optionally specify an output file name using `-o`; otherwise, it defaults to `output.dat`.

* **Syntax**:
    ```bash
    ./ex1 -i <input_filename> [-o <output_filename>]
    ```
* **Example using default output name (`output.dat`)**:
    ```bash
    ./ex1 -i input.dat
    ```
* **Example specifying output name**:
    ```bash
    ./ex1 -i input.dat -o simulation_results.dat
    ```

---

## Visualization

Run the Python script to generate the animation from the simulation output file.

* **Syntax**:
    ```bash
    python ex1_animation.py [-i <simulation_output_file>] [-o <animation_filename_base>]
    ```
* **Flags**:
    * `-i`: Specifies the data file generated by the Fortran simulation (defaults to `output.dat`).
    * `-o`: Specifies the base name for the output animation file (defaults to `ex1_animation`). The script will save it as `<animation_filename_base>.mp4`.
* **Example using defaults**: Reads `output.dat`, saves animation as `ex1_animation.mp4`.
    ```bash
    python ex1_animation.py
    ```
* **Example using custom files**: Reads `simulation_results.dat`, saves animation as `my_sim_anim.mp4`.
    ```bash
    python ex1_animation.py -i simulation_results.dat -o my_sim_anim
    ```
The script will save the `.mp4` file and then display the animation in a window.

---

## Input File Format (`input.dat`)

The input file must follow this structure:

1.  **Line 1**: `dt` (Integration time step, real number).
2.  **Line 2**: `dt_out` (Output time interval, real number).
3.  **Line 3**: `t_end` (Total simulation time, real number).
4.  **Line 4**: `n_particles` (Number of particles, integer).
5.  **Lines 5 to 5 + n_particles - 1**: Particle initial states, one particle per line.
    * Format per line: `mass px py pz vx vy vz` (7 real numbers separated by spaces)

---

## Output File Format (`output.dat`)

The output file contains the simulation state at intervals specified by `dt_out`. Each line represents a time step and has the following format:

* `time x1 y1 z1 x2 y2 z2 ... xN yN zN`
    * `time`: The simulation time for this snapshot (real number).
    * `xi yi zi`: The x, y, and z coordinates of particle `i` at that time (real numbers).

There are `1 + 3 * n_particles` columns in total.